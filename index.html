
<html>
    <head>
        <title>CS3300 project 2</title>
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script src="https://d3js.org/topojson.v2.min.js"></script>
        <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
        <script src="https://unpkg.com/d3-simple-slider@0.2.0/build/d3-simple-slider.js"></script>
        <script src="functions.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb"
        crossorigin="anonymous">
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
        <style>
            path.county { fill:#ccc; stroke:#fff; stroke-width: 0.5px }
            div.tooltip {
                position: absolute;
                text-align: center;
                width: 160px;
                height: 95px;
                padding: 2px;
                font: 15px sf pro display;
                background: lightsteelblue;
                border: 0px;
                border-radius: 8px;
                pointer-events: none;
            }
            .legend rect{
                stroke: #000;
            }
            .legend, .legend_title text{
                font-size:10pt;
            }

            path.slice{
                stroke-width:2px;
            }

            polyline{
                opacity: .3;
                stroke: black;
                stroke-width: 2px;
                fill: none;
            }
        </style>
    </head>
    <body>
        <div id="title"></div>
        <div>
            <div style="float: left; width: 3%; margin-left: 100px">Income: <span id="income" >â€¦</span></div>
            <div style="float: left; width: 30%" id="slider2"></div>
            <div style="float: left; width: 20%" id="legend"></div>
        </div>

        <div>
            <svg id="map" height="600" width="1000"></svg>
            <svg id="piechart" style="padding-left: 100" height="600" width="800"></svg>
        </div>
        <div id="longest"></div>
        <script>
            // Define the div for the tooltip
            var div = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);
            //graph title
            var title = d3.select("#title")
                .append("svg")
                .attr("width", 1000)
                .attr("height", 150);
            title.append("text")
                .attr("transform", "translate(350,40)")
                .attr("text-anchor", "middle")
                .style("font-size", 25)
                .style("font-weight", "medium")
                .style("font-family", "Raleway")
                .text("Can you pay your way to a better, longer life?");
            title.append("text")
                .attr("transform", "translate(300,65)")
                .attr("text-anchor", "middle")
                .style("font-size", 18)
                .style("font-weight", "medium")
                .style("font-family", "Raleway")
                .text("lifespans and cost-of-living across US Counties");
            title.append("text")
                .attr("transform", "translate(125,95)")
                .attr("text-anchor", "left")
                .style("font-size", 15)
                .style("font-weight", "medium")
                .style("font-family", "Raleway")
                .text("(Affordability = no more than 45% of income spent on)")

// var icons = ["home", "taxi"];

// var defaultStyle = {
//   padding: "0px 5px 0px 5px",
//   margin: "5px",
//   "border-radius": "10px",
//   "background-color": "white",
//   "stroke": "none",
//   "cursor": "pointer"
// };

// d3.select("#title").selectAll("i").data(icons)
//   .enter().append("i")
//   .attr("class", function(d){ 
//     return "icon fa fa-5x fa-" + d;
//   })
//   .style(defaultStyle);

            var svg = d3.select("#map");
            var projection = d3.geoAlbersUsa().scale(75);
            var pathGenerator = d3.geoPath().projection(projection);
            var counties;
            var data;
            var inputValue = null;
            //define color scale
            var color_na = d3.rgb("#d4d4d4");
            var colors = ["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"];
            var colorScale = d3.scaleLinear().domain([66,75.64,77.26,78.56,79.82,87]).range(colors);
            //extreme values
            var county_longest;
            var county_shortest;
            var longest_life_expectancy;
            var shortest_life_expectancy;
            var affordableCount = 0;
            var affordablePercent = "affordable: " + "0%";
            var unaffordablePercent = "unaffordable: " + "100%";

            var color = d3.scaleOrdinal()
                .domain([affordablePercent, unaffordablePercent])
                .range(["#98abc5", "#8a89a6"]);
            //initialize legend container
            var legend = d3.select("#legend")
                .append("svg")
                .attr("width", 250)
                .attr("height", 175)
            //add legend title
            legend.append("text")
            .attr("transform", "translate(50, 15)")
            .style("font-size", 15)
            .style("font-weight", "bold")
            .style("font-family", "SF Pro Display")
            .text("legend for life expectancy");
            //initialize legend
            legendData = [
                {"coordinates": [50,30], "color": "#d4d4d4", "text": "Unaffordable"},
                {"coordinates": [50,60], "color": "#ffffcc", "text": "66"},
                {"coordinates": [50,80], "color": "#a1dab4", "text": ""},
                {"coordinates": [50,100], "color": "#41b6c4", "text": ""},
                {"coordinates": [50,120], "color": "#2c7fb8", "text": ""},
                {"coordinates": [50,140], "color": "#253494",  "text": "86"}
            ];

            legendData.forEach(function(d){
                legend.append("rect")
                .attr("x", d.coordinates[0])
                .attr("y", d.coordinates[1])
                .attr("height", 20)
                .attr("width", 20)
                .style("fill", d.color)
                .style("opacity", 0.8)
                .on("mouseover", function(d) { legendMouseOver(d, data)})
                .on("mouseout", function() { legendMouseOut(data)})
                var y = d.coordinates[1] + 15;
                legend.append("text")
                .attr("transform", "translate(80 , " + y + ")")
                .style("font-size", 15)
                .style("font-family", "SF Pro Display")
                .text(d.text);
            });

            var longest = d3.select("#longest")
                .append("svg")
                .attr("width", 350)
                .attr("height", 100)

            //adding the counties with longest life expectancy
            longest.append("text")
                .attr("id", "county1")
                .attr("transform", "translate(10,40)")
                .style("font-size", 15)
                .style("font-weight", "bolder")
                .style("font-family", "SF Pro Display")
                .text("County where you will live longest" + county_longest + ", " + longest_life_expectancy)
           longest.append("text")
               .attr("id", "county2")
               .attr("transform", "translate(10,80)")
               .style("font-size", 15)
               .style("font-weight", "bolder")
               .style("font-family", "SF Pro Display")
               .text("shortes " + county_shortest + ", " + shortest_life_expectancy + affordableCount)
            //load data
            d3.queue()
            .defer(d3.json, "us.json")
            .defer(d3.csv, "us_county_health_wealth.csv")
            .await(callback);
            function callback(error, rawMap, rawData){
                data = d3.map(rawData, function(d) {
                    return Number(d.FIPS);
                });
                counties = topojson.feature(rawMap, rawMap.objects.counties);
                projection.fitExtent([[0,0], [svg.attr("width"), svg.attr("height")]], counties);
                pathGenerator = d3.geoPath().projection(projection);
                //init map
                svg.selectAll("path.county")
                .data(counties.features)
                .enter().append("path")
                .attr("class", "county")
                .attr("d", function(county) {
                    return pathGenerator(county);
                })
                .call(fillMap, data)
                //mouse hovering
                .on('mouseover', function(d) {
                    var currentState = this;
                    countyMouseOver(currentState, data.get(d.id));
                })
                .on('mouseout', function(d) {
                    countyMouseOut(d);
                })
                //scatterPlot(rawData);
            }

            //the slider
            var slider2 = d3.sliderHorizontal()
            .min(d3.min([35,40]))
            .max(105)
            .step(5)
            .width(400)
            .on('onchange', val => {
            d3.select("p#value2").text(val);
                update(val * 1000, data);
                change(randomData(affordableCount));
            });
            var g = d3.select("div#slider2").append("svg")
                .attr("width", 500)
                .attr("height", 100)
                .append("g")
                .attr("transform", "translate(30,30)");
            g.call(slider2);
            d3.select("p#value2").text((slider2.value()));
            d3.select("a#setValue2").on("click", () => slider2.value(5));

            //initialize map
            update(35000, data);

            //piechart
            var width = 600,
                height = 400,
                paddingX = 20,
                paddingY = 20,
                radius = Math.min(width, height) / 2;
            var piechart = d3.select("#piechart")
                .append("g")

                piechart.append("g")
                .attr("class", "slices")
                piechart.append("g")
                .attr("class", "labels");
                piechart.append("g")
                .attr("class", "lines");
                
            var transformX = width / 2 + paddingX, transformY =  height / 2 + paddingY;

            var pie = d3.pie()
                .sort(null)
                .value(function(d) {
                    return d.value;
                });

            var arc = d3.arc()
                .outerRadius(radius * 0.8)
                .innerRadius(radius * 0.4);

            var outerArc = d3.arc()
                .innerRadius(radius * 0.9)
                .outerRadius(radius * 0.9);

            var key = function(d){ return d.data.label; };

            piechart
            .attr("width", 400)
            .attr("height", 400)
            .attr("transform", "translate(" + transformX + "," + transformY+ ")");

            change(randomData(affordableCount));
        </script>
    </body>
</html>
